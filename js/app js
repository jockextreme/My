new Vue({
    el: '#app',
    data: {
        videos: [],
        currentVideo: null,
        showModal: false,
        page: 1,
        limit: 10,
        totalVideos: 0
    },
    computed: {
        showLoadMore() {
            return this.totalVideos > this.videos.length;
        }
    },
    methods: {
        async fetchVideos() {
            try {
                const response = await fetch(
                    `https://kaiz-apis.gleeze.com/api/lootedpinay?limit=${this.limit}&page=${this.page}&apikey=0acad241-6a34-4516-bcc6-310a137e6357`
                );
                const data = await response.json();
                this.totalVideos = data.total;
                this.videos = [...this.videos, ...data.videos.map(video => ({
                    ...video,
                    likes: localStorage.getItem(video.title) || 0,
                    liked: localStorage.getItem(`${video.title}_liked`) === 'true'
                }))];
            } catch (error) {
                console.error('Error fetching videos:', error);
            }
        },
        playVideo(video) {
            this.currentVideo = video;
            this.showModal = true;
            this.$nextTick(() => {
                this.$refs.videoPlayer.play();
            });
        },
        closeModal() {
            this.showModal = false;
            if(this.$refs.videoPlayer) {
                this.$refs.videoPlayer.pause();
            }
        },
        toggleLike(video) {
            video.liked = !video.liked;
            video.likes = video.liked ? parseInt(video.likes) + 1 : parseInt(video.likes) - 1;
            localStorage.setItem(video.title, video.likes);
            localStorage.setItem(`${video.title}_liked`, video.liked);
        },
        shareVideo(video) {
            if (navigator.share) {
                navigator.share({
                    title: video.title,
                    text: 'Check out this free video!',
                    url: video.mp4url
                });
            } else {
                alert('Sharing is not supported in your browser');
            }
        },
        loadMore() {
            this.page++;
            this.fetchVideos();
        }
    },
    mounted() {
        this.fetchVideos();
    }
});
