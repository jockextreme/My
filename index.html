<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains same -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/8.0.4/video-js.min.css" rel="stylesheet">
</head>
<body>
    <!-- Previous navigation remains same -->

    <section class="section">
        <div class="container">
            <!-- Add Pagination Controls -->
            <div class="level" id="pagination" style="display: none;">
                <div class="level-left">
                    <button class="button" onclick="loadPage('prev')" id="prevBtn">Previous</button>
                </div>
                <div class="level-right">
                    <button class="button" onclick="loadPage('next')" id="nextBtn">Next</button>
                </div>
            </div>

            <!-- Add Dark Mode Toggle -->
            <div class="has-text-right mb-4">
                <button class="button is-dark" id="darkModeToggle" onclick="toggleDarkMode()">
                    üåì Dark Mode
                </button>
            </div>

            <!-- Updated Detail Modal with Tabs -->
            <div class="modal" id="detailModal">
                <div class="modal-background"></div>
                <div class="modal-card" style="max-width: 960px">
                    <header class="modal-card-head">
                        <p class="modal-card-title" id="detailTitle"></p>
                        <button class="delete" aria-label="close" onclick="closeModal()"></button>
                    </header>
                    
                    <div class="tabs is-boxed">
                        <ul>
                            <li class="is-active" id="infoTab"><a onclick="switchTab('info')">Info</a></li>
                            <li id="screenshotsTab"><a onclick="switchTab('screenshots')">Screenshots</a></li>
                            <li id="downloadsTab"><a onclick="switchTab('downloads')">Downloads</a></li>
                        </ul>
                    </div>

                    <section class="modal-card-body" id="detailContent">
                        <!-- Dynamic content loaded here -->
                    </section>
                </div>
            </div>

            <!-- Add History Section -->
            <div class="box mt-5" id="historySection" style="display: none;">
                <h2 class="title is-5">Search History</h2>
                <div id="searchHistory"></div>
            </div>
        </div>
    </section>

    <script>
        // Add new configuration
        const config = {
            API_KEY: '625156d0d268e4633b97980c0dc859d0',
            currentPage: 1,
            lastSearch: '',
            searchHistory: [],
            darkMode: false
        };

        // Modified search function with pagination
        async function searchVideos(page = 1) {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            config.currentPage = page;
            config.lastSearch = query;
            updateSearchHistory(query);

            try {
                const response = await fetch(
                    `https://api.zetsu.xyz/javhd?action=search&query=${encodeURIComponent(query)}&page=${page}&apikey=${config.API_KEY}`
                );
                
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                
                displayResults(data);
                document.getElementById('pagination').style.display = 'flex';
            } catch (error) {
                showNotification(error.message || 'Search failed', 'is-danger');
            }
        }

        // Enhanced detail handling
        async function showDetail(url) {
            try {
                const response = await fetch(
                    `https://api.zetsu.xyz/javhd?action=detail&url=${encodeURIComponent(url)}&apikey=${config.API_KEY}`
                );
                
                const detail = await response.json();
                if (!detail.videos || !detail.videos.length) {
                    throw new Error('No video sources found');
                }
                
                displayEnhancedDetail(detail);
            } catch (error) {
                showNotification(error.message || 'Failed to load details', 'is-danger');
            }
        }

        // New function for enhanced detail display
        function displayEnhancedDetail(detail) {
            document.getElementById('detailTitle').textContent = detail.title;
            
            const content = `
                <div id="infoContent" class="tab-content">
                    <div class="columns">
                        <div class="column is-4">
                            <img src="${detail.cover}" alt="Cover" class="image">
                            ${detail.rating ? `<div class="mt-3">
                                <strong>Rating:</strong> 
                                ${renderStars(detail.rating)}
                            </div>` : ''}
                        </div>
                        <div class="column">
                            ${detail.info ? `<p class="content">${detail.info}</p>` : ''}
                            ${renderMetadata(detail)}
                        </div>
                    </div>
                    
                    <div class="video-player-container mt-4">
                        ${detail.videos.map(video => `
                            <div class="video-container">
                                <video class="video-js" controls preload="auto" 
                                    data-setup='{"fluid": true}'>
                                    <source src="${video.url}" type="video/mp4">
                                </video>
                                ${video.quality ? `<div class="video-quality">${video.quality}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div id="screenshotsContent" class="tab-content" style="display:none">
                    <div class="columns is-multiline">
                        ${(detail.screenshots || []).map(img => `
                            <div class="column is-3">
                                <img src="${img}" class="image screenshot" onclick="openLightbox('${img}')">
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div id="downloadsContent" class="tab-content" style="display:none">
                    ${(detail.downloads || []).map(link => `
                        <a href="${link.url}" class="button is-fullwidth is-link mb-2">
                            Download (${link.quality} - ${link.size})
                        </a>
                    `).join('')}
                </div>
            `;

            document.getElementById('detailContent').innerHTML = content;
            initializeVideoPlayers();
        }

        // New helper functions
        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            return '‚òÖ'.repeat(fullStars) + '‚òÜ'.repeat(5 - fullStars);
        }

        function renderMetadata(detail) {
            return `
                <div class="content">
                    ${detail.actress ? `<p><strong>Actress:</strong> ${detail.actress.join(', ')}</p>` : ''}
                    ${detail.release_date ? `<p><strong>Release Date:</strong> ${detail.release_date}</p>` : ''}
                    ${detail.duration ? `<p><strong>Duration:</strong> ${detail.duration}</p>` : ''}
                    ${detail.tags ? `<p><strong>Tags:</strong> ${detail.tags.join(', ')}</p>` : ''}
                </div>
            `;
        }

        // New features implementation
        function toggleDarkMode() {
            config.darkMode = !config.darkMode;
            document.body.classList.toggle('has-background-dark', config.darkMode);
            document.body.classList.toggle('has-text-light', config.darkMode);
            document.getElementById('darkModeToggle').textContent = 
                config.darkMode ? '‚òÄÔ∏è Light Mode' : 'üåì Dark Mode';
        }

        function updateSearchHistory(query) {
            if (!config.searchHistory.includes(query)) {
                config.searchHistory.push(query);
                const historyItem = `<span class="tag is-info is-light mr-2 mb-2" 
                    onclick="quickSearch('${query}')">${query}</span>`;
                document.getElementById('searchHistory').innerHTML += historyItem;
                document.getElementById('historySection').style.display = 'block';
            }
        }

        function quickSearch(query) {
            document.getElementById('searchInput').value = query;
            searchVideos();
        }

        function switchTab(tabName) {
            // Tab switching logic
        }

        function showNotification(message, type = 'is-info') {
            // Notification system implementation
        }

        // Initialize video.js players
        function initializeVideoPlayers() {
            videojs.getAllPlayers().forEach(player => player.dispose());
            Array.from(document.querySelectorAll('.video-js')).forEach(el => {
                videojs(el);
            });
        }

        // Add lightbox function
        function openLightbox(imgUrl) {
            // Lightbox implementation
        }
    </script>
    <script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>
</body>
</html>
