<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zetsu API Video Browser</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --card-bg: #ffffff;
            --primary-color: #007bff;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --primary-color: #00a8ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-container {
            flex-grow: 1;
            max-width: 600px;
            position: relative;
        }

        #searchInput {
            padding: 12px 20px;
            width: 100%;
            border: 2px solid var(--primary-color);
            border-radius: 25px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .filter-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }

        .video-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .thumbnail-container {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .uploader {
            color: var(--primary-color);
            font-size: 0.9em;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            color: var(--text-color);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
        }

        .error-message {
            color: #dc3545;
            text-align: center;
            padding: 20px;
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search videos..." 
                   aria-label="Search videos">
            <div class="filters">
                <button class="filter-btn" onclick="filterVideos('all')" id="filterAll">All</button>
                <button class="filter-btn" onclick="filterVideos('short')" id="filterShort">Short (<5min)</button>
                <button class="filter-btn" onclick="filterVideos('medium')" id="filterMedium">Medium (5-15min)</button>
                <button class="filter-btn" onclick="filterVideos('long')" id="filterLong">Long (>15min)</button>
                <select id="categoryFilter" class="filter-btn" onchange="filterByCategory(this.value)">
                    <option value="">All Categories</option>
                </select>
            </div>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
    </div>

    <div class="loading" id="loading">
        Loading... <div class="spinner">‚è≥</div>
    </div>
    <div class="error-message" id="errorMessage"></div>
    <div class="video-grid" id="videoContainer"></div>

    <script>
        const API_KEY = '625156d0d268e4633b97980c0dc859d0';
        let currentData = [];
        let currentPage = 1;
        let currentFilter = 'all';
        let currentCategory = '';

        // Initialize
        window.onload = function() {
            loadThemePreference();
            fetchVideos('home');
            setupSearchDebounce();
        };

        // Enhanced fetch function with pagination
        async function fetchVideos(type, query = '', page = 1) {
            showLoading();
            hideError();
            
            try {
                let url;
                if (type === 'home') {
                    url = `https://api.zetsu.xyz/prn/home?apikey=${API_KEY}&page=${page}`;
                } else {
                    const encodedQuery = encodeURIComponent(query);
                    url = `https://api.zetsu.xyz/prn/search/${encodedQuery}?apikey=${API_KEY}&page=${page}`;
                }

                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch');
                
                const data = await response.json();
                currentData = page === 1 ? data : [...currentData, ...data];
                
                displayVideos(currentData);
                populateCategories(currentData);
                setupInfiniteScroll();
            } catch (error) {
                showError('Failed to load videos. Please try again later.');
            } finally {
                hideLoading();
            }
        }

        // Improved display function with filtering
        function displayVideos(data) {
            const container = document.getElementById('videoContainer');
            container.innerHTML = '';

            const filteredVideos = data.filter(video => {
                if (typeof video !== 'object') return false;
                const duration = parseDuration(video.duration);
                
                return matchesFilter(duration) && matchesCategory(video);
            });

            filteredVideos.forEach(video => {
                if (!video.video) return;
                
                const card = document.createElement('div');
                card.className = 'video-card';
                card.innerHTML = `
                    <div class="thumbnail-container">
                        <img src="${video.thumbnail || 'placeholder.jpg'}" 
                             alt="${video.title}" 
                             class="thumbnail"
                             loading="lazy">
                        <div class="duration">${video.duration}</div>
                    </div>
                    <div class="video-info">
                        <div class="video-title" title="${video.title}">${video.title}</div>
                        ${video.uploaderName ? `
                        <div class="uploader">
                            <span>${video.uploaderName}</span>
                            <button onclick="copyLink('${video.video}')" 
                                    aria-label="Copy video link"
                                    class="filter-btn">üîó</button>
                        </div>` : ''}
                    </div>
                `;
                
                card.querySelector('.thumbnail-container').addEventListener('click', () => {
                    window.open(video.video, '_blank');
                });
                container.appendChild(card);
            });
        }

        // New features implementation
        function setupInfiniteScroll() {
            window.onscroll = () => {
                if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                    currentPage++;
                    fetchVideos('home', '', currentPage);
                }
            };
        }

        function filterVideos(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => 
                btn.classList.remove('active'));
            document.getElementById(`filter${type.charAt(0).toUpperCase() + type.slice(1)}`)
                .classList.add('active');
            displayVideos(currentData);
        }

        function populateCategories(data) {
            const categories = new Set();
            data.forEach(video => {
                if (video.uploaderName) categories.add(video.uploaderName);
            });
            
            const select = document.getElementById('categoryFilter');
            select.innerHTML = `<option value="">All Categories</option>${
                [...categories].map(cat => 
                    `<option value="${cat}">${cat}</option>`
                ).join('')
            }`;
        }

        function filterByCategory(category) {
            currentCategory = category;
            displayVideos(currentData);
        }

        function toggleTheme() {
            document.body.setAttribute('data-theme',
                document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
            localStorage.setItem('theme', document.body.getAttribute('data-theme'));
        }

        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
        }

        function copyLink(url) {
            navigator.clipboard.writeText(url);
        }

        function setupSearchDebounce() {
            let timeout;
            document.getElementById('searchInput').addEventListener('input', (e) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => searchVideos(e.target.value), 500);
            });
        }

        // Utility functions
        function parseDuration(duration) {
            const match = duration.match(/(\d+)\s*min/);
            return match ? parseInt(match[1]) : 0;
        }

        function matchesFilter(duration) {
            switch(currentFilter) {
                case 'short': return duration < 5;
                case 'medium': return duration >= 5 && duration <= 15;
                case 'long': return duration > 15;
                default: return true;
            }
        }

        function matchesCategory(video) {
            return !currentCategory || video.uploaderName === currentCategory;
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }
    </script>
</body>
</html>
